define(["jquery","core/ajax","core/url","core/notification"],function(a,b,c,d){var e=function(b){var d=c.imageUrl("i/loading_small","moodle"),e=document.createElement("img");e.className="spinner"+b,e.src=d,e.hidden=!1,a(".imggroup-"+b).before(e)},f=function(b){a(".block_groups").find(".spinner"+b).remove()},g=function(b){if(a(".block_groups").find(".warning"+b).length>0)return f(b),h(),!1;var d=c.imageUrl("i/warning","moodle"),e=document.createElement("img");e.className="warning"+b,e.src=d,f(b),a(".imggroup-"+b).before(e).on("click",h())},h=function(){d.alert("Error","The requested change was not possible","OK")},i=function(c){var d=a(this).data("groupid");if(a(".block_groups").find(".spinner"+a(this).data("groupid")).length>0)return!1;e(a(this).data("groupid")),a.ajax({timeout:3e3});var h=b.call([{methodname:"block_groups_create_output",args:{groups:{id:a(this).data("groupid"),courseid:c.data.courseid}}}]);return a(document).ajaxError(function(){return g(d),!1}),h[0].done(function(b){return null===b?(g(d),!1):b.error===!0?(g(d),!1):(a(".block_groups").find(".group-"+b.id).replaceWith(b.newelement),0===b.visibility&&a(".block_groups").find(".membergroup-"+b.id).removeClass("hiddengroups"),1===b.visibility&&a(".block_groups").find(".membergroup-"+b.id).addClass("hiddengroups"),a(".block_groups").find(".group-"+b.id+" .block_groups_toggle").on("click",{courseid:c.data.courseid},i),void f(b.id))}).fail(function(){return g(d),!1}),!1};return{initialise:function(b){a(".block_groups_toggle").on("click",{courseid:b},i)}}});