define(["jquery","core/ajax","core/url","core/notification"],function(a,b,c,d){var e=function(b){a(".block_groups").find(".warning"+b).remove()},f=function(b){a(".block_groups").find(".spinner"+b).remove()},g=function(){d.alert(M.util.get_string("errortitle","block_groups",""),M.util.get_string("nochangeindatabasepossible","block_groups",""),M.util.get_string("errorbutton","block_groups",""))},h=function(b){var d=a(".block_groups");d.find(".warning"+b).length>0&&e(b);var f=c.imageUrl("i/loading_small","moodle"),g=document.createElement("img");g.className="spinner"+b,g.src=f,g.hidden=!1,d.find(".imggroup-"+b).before(g)},i=function(b){var d=a(".block_groups");if(d.find(".warning"+b).length>0)return f(b),g(),!1;var e=c.imageUrl("i/warning","moodle"),h=document.createElement("img");return h.className="warning"+b,h.src=e,f(b),d.find(".imggroup-"+b).before(h).on("click",g),!0},j=function(c){var d=a(this).data("groupid"),e=a(".block_groups");if(e.find(".spinner"+a(this).data("groupid")).length>0)return!1;h(a(this).data("groupid"));var g=b.call([{methodname:"block_groups_create_output",args:{groups:{id:a(this).data("groupid"),courseid:c.data.courseid}}}]);return a(document).ajaxError(function(){return i(d),!1}),g[0].done(function(b){return null===b?(i(d),!1):b.error===!0?(i(d),!1):(e.find(".group-"+b.id).replaceWith(b.newelement),0===b.visibility&&a(".block_groups").find(".membergroup-"+b.id).removeClass("hiddengroups"),1===b.visibility&&a(".block_groups").find(".membergroup-"+b.id).addClass("hiddengroups"),e.find(".group-"+b.id+" .block_groups_toggle").on("click",{courseid:c.data.courseid},j),f(b.id),!0)}).fail(function(){return i(d),!1}),!1};return{initialise:function(b){a(".block_groups_toggle").on("click",{courseid:b},j)}}});